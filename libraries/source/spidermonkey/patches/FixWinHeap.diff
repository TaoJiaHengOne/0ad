
# HG changeset patch
# User Mike Hommey <mh+mozilla@glandium.org>
# Date 1684810882 0
# Node ID 9c84e12328a105874d1769800bb132e78befc8b2
# Parent  1e6bdb2d359480234077ac0ec5592dced8184921
Bug 1802675 - Don't build winheap.cpp when mozglue is a static library. r=firefox-build-system-reviewers,andi

Differential Revision: https://phabricator.services.mozilla.com/D163383

diff --git a/memory/mozalloc/moz.build b/memory/mozalloc/moz.build
--- a/memory/mozalloc/moz.build
+++ b/memory/mozalloc/moz.build
@@ -17,20 +17,22 @@ if CONFIG["WRAP_STL_INCLUDES"]:
         EXPORTS.mozilla += ["throw_gcc.h"]
     elif CONFIG["CC_TYPE"] == "clang-cl":
         DEFINES["_HAS_EXCEPTIONS"] = 0
         SOURCES += [
             "msvc_raise_wrappers.cpp",
         ]
 
 if CONFIG["OS_TARGET"] == "WINNT":
-    # Keep this file separate to avoid #include'ing windows.h everywhere.
-    SOURCES += [
-        "winheap.cpp",
-    ]
+    # Don't build winheap.cpp when mozglue is a static library.
+    if CONFIG["MOZ_MEMORY"] or not CONFIG["JS_STANDALONE"]:
+        # Keep this file separate to avoid #include'ing windows.h everywhere.
+        SOURCES += [
+            "winheap.cpp",
+        ]
 
 UNIFIED_SOURCES += [
     "mozalloc.cpp",
     "mozalloc_abort.cpp",
     "mozalloc_oom.cpp",
 ]
 
 if CONFIG["MOZ_MEMORY"]:

